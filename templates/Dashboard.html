<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>TCR</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="./node_modules/web3/dist/web3.min.js"></script>
    <style>
      .checked {
        color: orange;
      }
      .curatedList {
        width: 80%;

      }
      .curatedList .card{
        border-bottom: 2px solid black;
        border-top: 2px solid black;
        margin: 10px;
        padding: 10px;
      }
      .detail{
        float: right;
        width: 40%;
      }
      .detail .param{
        float: left;
      }
      .reviews{
        margin: 5px;
        text-align: right;
      }
      #listHead{
        text-align: center;
        margin-bottom: 30px;
      }

      </style>
            <script>
                window.addEventListener('load',function(){
                  console.log("hello");
                  if(window.ethereum){
                    window.web3=new Web3(window.ethereum);
                    window.ethereum.enable().then(function(account){
                      console.log(account);
                      document.getElementById("acc").textContent=account[0];
											var tokContractabi=[
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_totalSupply",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_tokenPrice",
				"type": "uint256"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_spender",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_tokens",
				"type": "uint256"
			}
		],
		"name": "approve",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "balanceOf",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_tokens",
				"type": "uint256"
			}
		],
		"name": "buyTokens",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_tokenPrice",
				"type": "uint256"
			}
		],
		"name": "changeTokenPrice",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_tokens",
				"type": "uint256"
			}
		],
		"name": "exchangeTokensforEther",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_tokens",
				"type": "uint256"
			}
		],
		"name": "mintTokens",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "minter",
		"outputs": [
			{
				"internalType": "address payable",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "tokenPrice",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "totalSupply",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_tokens",
				"type": "uint256"
			}
		],
		"name": "transfer",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_from",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_tokens",
				"type": "uint256"
			}
		],
		"name": "transferFrom",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "withdrawContractEther",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
];
                      var abi=[
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_tokens",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			}
		],
		"name": "challengeApplication",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "resolveVote",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_tokens",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_website",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_location",
				"type": "string"
			},
			{
				"internalType": "uint8",
				"name": "_foodQuality",
				"type": "uint8"
			},
			{
				"internalType": "uint8",
				"name": "_service",
				"type": "uint8"
			},
			{
				"internalType": "uint8",
				"name": "_ambience",
				"type": "uint8"
			}
		],
		"name": "sendApplication",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "contract ResturantToken",
				"name": "_resturantToken",
				"type": "address"
			},
			{
				"internalType": "contract Queue",
				"name": "_resturantQueue",
				"type": "address"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "bool",
				"name": "_state",
				"type": "bool"
			}
		],
		"name": "vote",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "applicant",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "approvedList",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "approvedResturants",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "website",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "location",
				"type": "string"
			},
			{
				"internalType": "uint8",
				"name": "foodQuality",
				"type": "uint8"
			},
			{
				"internalType": "uint8",
				"name": "service",
				"type": "uint8"
			},
			{
				"internalType": "uint8",
				"name": "ambience",
				"type": "uint8"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "challenger",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "challengerDeposit",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "deadlineTime",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "deposit",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "lengthOfApprovedList",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "pendingResturants",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "website",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "location",
				"type": "string"
			},
			{
				"internalType": "uint8",
				"name": "foodQuality",
				"type": "uint8"
			},
			{
				"internalType": "uint8",
				"name": "service",
				"type": "uint8"
			},
			{
				"internalType": "uint8",
				"name": "ambience",
				"type": "uint8"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "resturantQueue",
		"outputs": [
			{
				"internalType": "contract Queue",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "resturantToken",
		"outputs": [
			{
				"internalType": "contract ResturantToken",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
					var tokenContract=new web3.eth.Contract(tokContractabi,"0x90Ca384e6C2733f439ed4EE76488818D60683217");
					tokenContract.methods.balanceOf(account[0]).call({from:account[0]}).then(function(receipt){
						document.getElementById("bal").textContent=receipt;
					});
          var x=new web3.eth.Contract(abi,"0x50e0A5082EB50D9BD218Bcbd4292B70CE0A4C1d4")
          x.methods.lengthOfApprovedList().call({from:account[0]}).then(function(receipt){
            console.log(receipt);
            for(var i=0;i<parseInt(receipt);i++){
              x.methods.approvedList(i).call({from:account[0]}).then(function(receipt){
                console.log(receipt);
                x.methods.approvedResturants(receipt).call({from:account[0]}).then(function(receipt){
                  console.log(receipt);
                  var restname=receipt[0];
                  var site=receipt[1];
                  var loc=receipt[2];
                  var fq=receipt[3];
                  var srv=receipt[4];
                  var amb=receipt[5];
                  var fqrating='';
                  var srvrating='';
                  var ambrating='';
                  for(var j=0;j<fq;j++){
                    fqrating+='<span class="fa fa-star checked"></span>';
                  }
                  for(var j=0;j<srv;j++){
                    srvrating+='<span class="fa fa-star checked"></span>';
                  }
                  for(var j=0;j<amb;j++){
                    ambrating+='<span class="fa fa-star checked"></span>';
                  }
                  var ele='<div class="card"> <div class="detail"> <div class="param">FOOD QUALITY</div> <div class="reviews">'+fqrating+'</div> <div class="param">SERVICE</div> <div class="reviews">'+srvrating+'</div> <div class="param">AMBIENCE</div> <div class="reviews">'+ambrating+'</div> </div> <h1>'+restname+'</h1> <a href='+site+'><p>Visit Website</p></a> </div>'
                  document.getElementById('lise').innerHTML += ele; 
                })
              })
            }

          })
                    });
                  }
                });
</script>
</head>
<body>
    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
          <div class="navbar-header">
            <a class="navbar-brand">Token Curated Resturants</a>
          </div>
          <ul class="nav navbar-nav">
            <li class="active"><a href="/purchase">Buy Tokens</a></li>
            <li><a href="/approve">Approve</a></li>
            <li><a href="/sendAppl">Send Application</a></li>
            <li><a href="/votechg">Vote/Challenge Application</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a id="acc">NONE</a></li>
            <li><a id="bal">0</a></li>
          </ul>
        </div>
      </nav>

      <div class="curatedList"  id="lise" >
          <h1 id="listHead">CURATED RESTURANTS</h1>
        </div>

</body>
</html>